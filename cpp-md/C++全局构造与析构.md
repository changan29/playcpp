### C++全局构造与析构

我们知道一般一个c/c++ 程序是由main开执行的，随着main函数的结束而结束。然而，在main函数被调用之前，为了程序能够顺利执行，要先初始化进程执行环境，比如堆分配初始化，线程子系统等. c++ 的全局对象构造函数也是在这一时期被执行的, C++的全局对象的构造函数在main之前被执行，析构函数在main之后被执行。

Linux系统下程序的入口是 _start,这个函数死Linux系统库glibc的一部分，当我们的程序与glibc库链接在一起形成最终的可执行文件以后，这个函数就是程序的初始化部分的入口。程序初始化部分完成一系列初始化过程之后，会调用main来执行程序的主体。在main函数执行完以后，返回到初始化部分，它进行一些清理工作，然后结束进程。

对于有些场合，程序的一些特定的操作必须在main函数之前被执行，还有一些操作必须在main函数之后执行，其中很有代表性的就是C++全局对象的构造和析构函数。因此，ELF定义了两个特殊的段。

```
.init 该段里面保存的是可执行指令，它构成了进程的初始化代码，
因此，当一个程序开始运行时，main函数调用之前，glibc的初始化部分安排执行这个段里面的代码。

.fini 该段保存着进程终止的代码，当一个程序的main退出时，glibc安排执行这里的代码
```

这两个段.init和.fini存在有特殊的目的，如果一个函数放到.init段里面，在main函数执行前系统会执行它。利用这两个特性，C++的全局构造和析构函数就由此实现。


